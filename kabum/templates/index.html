{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel = "icon" href = "https://image.flaticon.com/icons/png/512/1817/1817523.png" type = "image/x-icon"> 
  <meta name="description" content="Dashboard E-commerce made for a test">
  <meta name="author" content="Gabriel Henrique Casemiro">

  <title>Dashboard E-commerce</title>
  <!-- Importações do Bootstrap 4 -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

  <!-- Estilo padrão -->
  <link href="{% static 'css/style.css' %}" rel="stylesheet">

  <!-- Estilo para o menu lateral -->
  <link href="{% static 'css/simple-sidebar.css' %}" rel="stylesheet">

  <!-- Estilo para icones Font Awesome -->
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- Fonte padrão -->
  <link href="https://fonts.googleapis.com/css?family=Nunito&display=swap" rel="stylesheet">
</head>

<body>

  <div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div class="border-right border-dark side-menu" id="sidebar-wrapper">
      <div class="sidebar-heading">
        <center>
          <h3><span class="logo-text">E</span>-commerce</h3>
        </center>
      </div>
      <div class="list-group list-group-flush">
        <a href="/" class="list-group-item list-group-item-action bg-dark text-white"> Dashboard <span
            class="float-right rounded icone-menu"><i class="fa fa-home"></i></span> </a>
        <a href="/admin" class="list-group-item list-group-item-action bg-dark text-white d-sm-none"> Administration
          <span class="float-right rounded icone-menu"><i class="fa fa-user"></i></span> </a>
        <a href="/" class="list-group-item list-group-item-action bg-dark text-white d-sm-none"> Logout <span
            class="float-right rounded icone-menu"><i class="fa fa-sign-out"></i></span> </a>
      </div>
    </div>


    <!-- Conteúdo da página -->
    <div id="page-content-wrapper" class="bg-body">

      <nav class="navbar navbar-expand-lg navbar-light bg-dark border-bottom border-dark">
        <h3><span class="fa fa-bars pointer " id="menu-toggle"></span></h3>




        <ul class="navbar-nav ml-auto mt-2 mt-lg-0 ">

          <li class="nav-item dropdown d-none d-sm-block">

            <a class="nav-link dropdown-toggle rounded icone-login mr-2 p-2" href="#" id="navbarDropdown" role="button"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <img src="https://cdn1.iconfinder.com/data/icons/avatar-97/32/avatar-02-512.png" width="30px">
            </a>

            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="/admin">Administration</a>
              <a class="dropdown-item" href="/">Logout</a>
            </div>

          </li>
        </ul>

      </nav>

      <div class="container-fluid ">
        <div class="row mt-4">

          <div class="col-12 col-sm-6 col-lg-3  mb-4 mb-md-4">
            <div class="card bg-card-blue text-white">
              <div class="row">
                <div class="col-5 text-center icone-card">
                  <i class="fa fa-money mt-4"></i>
                </div>
                <div class="col-7 text-center mt-3">
                  <span class="text-card" id="total_sales">$ 0 </span> M
                  <p>Sales</p>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12 col-sm-6 col-lg-3 mb-4 mb-md-4">
            <div class="card bg-card-pink text-white">
              <div class="row">
                <div class="col-4 text-center icone-card">
                  <i class="fa fa-shopping-cart mt-4"></i>
                </div>
                <div class="col-8 text-center mt-3">
                  <span class="text-card" id="total_sales_ecommerce">$ 0 </span> M
                  <p>E-commerce sales</p>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12 col-sm-6 col-lg-3 mb-4 mb-md-4">
            <div class="card bg-card-yellow text-white">
              <div class="row">
                <div class="col-4 text-center icone-card">
                  <i class="fa fa-percent mt-4"></i>
                </div>
                <div class="col-8 text-center mt-3">
                  <span class="text-card" id="ecommerce_percent">0 %</span>
                  <p>E-commerce percent</p>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12 col-sm-6 col-lg-3 mb-4 mb-md-4">
            <div class="card bg-card-purple text-white">
              <div class="row">
                <div class="col-4 text-center icone-card">
                  <i class="fa fa-line-chart mt-4"></i>
                </div>
                <div class="col-8 text-center mt-3">
                  <span class="text-card" id="ecommerce_growth">0 % </span>
                  <p>E-commerce growth</p>
                </div>
              </div>
            </div>
          </div>

        </div>
        <!-- GRAFICO -->
        <div class="row mt-3">
          <div class="col-12">

            <div class="card bg-dark p-2 shadow">
              <div class="col-12 text-white mt-2 mb-2">
                <h5> Total and E-commerce sales by Merchandise Line: 1999-2015.</h5>
              </div>
              <br>
              <div class="row">
                <div class="col-lg-7 text-center icone-card p-0 pl-2" id="div-chart">
                  <div id="traffic-chart" class="traffic-chart"></div>

                </div>
                <div class="col-lg-5 text-card mt-3">

                  <div class="input-group mb-3 shadow " style="font-size:17px;">
                    <select class="custom-select bg-body text-white border-dark" id="ano_analise">
                      <option value="2015" selected>Select a year</option>

                    </select>
                  </div>

                  <div class="progress-box progress-2">
                    <h4 class="por-title">Sales growth based on the last year </h4>
                    <div class="por-txt text-white">$ <span id="sales_number">0</span> M (<span
                        id="sales_growth">0</span>%)</div>
                    <div class="progress mb-2" style="height: 5px;">
                      <div class="progress-bar bg-card-yellow progress-bar-striped progress-bar-animated"
                        id="progress-sales" role="progressbar" style="width: 60%;" aria-valuenow="60" aria-valuemin="0"
                        aria-valuemax="100"></div>
                    </div>
                  </div>

                  <div class="progress-box progress-2">
                    <h4 class="por-title">E-commerce sales growth based on the last year</h4>
                    <div class="por-txt text-white">$ <span id="sales_ecommerce_number">0</span> M (<span
                        id="sales_ecommerce_growth">0</span>%)</div>
                    <div class="progress mb-2" style="height: 5px;">
                      <div class="progress-bar bg-card-blue" id="progress-sales-ecommerce" role="progressbar"
                        style="width: 90%;" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>

                </div>
              </div>
            </div>

          </div>

        </div>
        <div class="row mt-2">
          <div class="col-12">

            <table class="table table-borderless table-striped table-dark shadow" style="font-size:14px;">
              <thead class="bg-dark">
                <tr>
                  <th>Merchandise Line</th>
                  <th>Total</th>
                  <th>E-commerce</th>
                </tr>
              </thead>
              <tbody id="tbody">


              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>


  </div>
  <!-- /#wrapper -->

  <!-- Bootstrap core JavaScript -->
  <!-- Importações do Bootstrap 4 -->

  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.7.3/dist/Chart.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <!-- Importação dos dados -->
  <script src="{% static 'js/dados.js' %}"></script>
  <script src="{% static 'js/init-charts.js' %}"></script>
  <script src="{% static 'js/script.js' %}"></script>
  <script>

    function get_percent_of_value(target, total) {
      // Função responsável por retornar o número
      return Math.round(100 * target / total)
    }

    var graph_data_sales = [];
    var graph_data_ecommerce = [];
    var labels = [];
    labels_table = ["Books and magazines",
      "Clothing and accessories",
      "Computer Hardware",
      "Computer Software",
      "Drugs and health aids",
      "Electronics and appliances",
      "Food, beer, and wine",
      "Furniture and home furnishing",
      "Music and Videos",
      "Office equipment and supplies",
      "Sporting Goods",
      "Toys, hobby goods, and games",
      "Other merchandise",
      "Nonmerchandise receipts"]

    // Popular o select
    for (i = 2015; i >= 1999; i--) {
      $('#ano_analise').append(`<option value="${i}">${i}</option>`);
    }


    //Função reponsável por mudar os dados quando selecionado um novo ano
    function change_data(year) {
      // Zera variaveis
      $("#div-chart").hide('slow', function () {


      });
      $("#div-chart").html('<canvas id="SalesChart"></canvas>');
      $("#div-chart").show('slow');


      graph_data_sales = [];
      graph_data_ecommerce = [];
      labels = [];

      year = parseInt(year);

      graph_data_sales, graph_data_ecommerce, labels = populateGraph(year, graph_data_sales, graph_data_ecommerce, labels);


      //Atualiza os cards
      $("#total_sales").html("$ " + dados[year]["Total_sales"]);
      $("#total_sales_ecommerce").html("$ " + dados[year]["Total_Ecommerce"]);
      percent_year = get_percent_of_value(dados[year]["Total_Ecommerce"], dados[year]["Total_sales"]);
      $("#ecommerce_percent").html(percent_year + " %");

      //Atualiza as barras de progresso do lado direito do gráfico
      if (year > 1999) {

        $("#ecommerce_growth").html(get_percent_of_value(dados[year]["Total_Ecommerce"] - dados[year - 1]["Total_Ecommerce"], dados[year]["Total_Ecommerce"]) + " %");
        $("#sales_number").html(dados[year]["Total_sales"]);
        percent_growth_sales = get_percent_of_value(dados[year]["Total_sales"] - dados[year - 1]["Total_sales"], dados[year]["Total_sales"]);
        $("#sales_growth").html(percent_growth_sales);
        $("#progress-sales").attr('style', 'width: ' + percent_growth_sales + '%;');

        $("#sales_ecommerce_number").html(dados[year]["Total_Ecommerce"]);
        percent_growth_sales_ecommerce = get_percent_of_value(dados[year]["Total_Ecommerce"] - dados[year - 1]["Total_Ecommerce"], dados[year]["Total_Ecommerce"]);
        $("#sales_ecommerce_growth").html(percent_growth_sales_ecommerce);
        $("#progress-sales-ecommerce").attr('style', 'width: ' + percent_growth_sales_ecommerce + '%;');

      } else {

        // No caso de ser 1999
        $("#sales_number").html(0);
        $("#sales_growth").html(0);
        $("#progress-sales").attr('style', 'width: 0%;');
        $("#ecommerce_growth").html("-");
        $("#sales_ecommerce_number").html(0);
        $("#sales_ecommerce_growth").html(0);
        $("#progress-sales-ecommerce").attr('style', 'width:0%;')

      }


      //Atualiza o Gráfico
      createSaleChart(graph_data_sales, graph_data_ecommerce, labels);



      //Atualiza os dados da tabela
      updateTable(labels_table, dados, year);
    }



    // Menu lateral
    $("#menu-toggle").click(function (e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });

    //Função que olha o select
    $("#ano_analise").change(function () {
      var year = $(this).val();
      change_data(year);
    })
    //Primeira execução é por padrão 2015
    change_data(2015);
  </script>

</body>

</html>